# Flare IM Core 基础配置

[service]
name = "flare-im-core"
version = "0.1.0"

[server]
address = "0.0.0.0"
port = 50051

[registry]
# 注册中心类型：etcd, consul, mesh
registry_type = "consul"
# 注册中心端点列表（Consul 默认端口 8500）
endpoints = ["http://localhost:28500"]
# 命名空间
namespace = "flare"
# TTL（秒）
ttl = 30
# 负载均衡策略：round_robin, random, consistent_hash, least_connections
# 默认：consistent_hash（一致性哈希，推荐用于网关路由）
load_balance_strategy = "consistent_hash"

[logging]
# 日志级别：trace, debug, info, warn, error
# 默认：debug（开发环境推荐，生产环境建议使用 info）
# 可以通过环境变量 RUST_LOG 覆盖，例如：RUST_LOG=info cargo run
level = "debug"
# 是否显示目标模块名称
with_target = false
# 是否显示线程ID
with_thread_ids = true
# 是否显示文件名
with_file = true
# 是否显示行号
with_line_number = true

[mesh]
enabled = false
service_name = "flare-im-core"
namespace = "default"

[redis.conversation_store]
url = "redis://localhost:26379/0"
namespace = "flare:conversation"
ttl_seconds = 3600

[redis.token_store]
url = "redis://localhost:26379/1"
namespace = "flare:token"
ttl_seconds = 7200

[redis.media_metadata]
url = "redis://localhost:26379/2"
namespace = "flare:media"
ttl_seconds = 3600

[redis.upload_conversations]
url = "redis://localhost:26379/3"
namespace = "flare:media:upload"
ttl_seconds = 86400

[redis.message_wal]
url = "redis://localhost:26379/4"
namespace = "flare:message:wal"
ttl_seconds = 86400

[kafka.push]
bootstrap_servers = "127.0.0.1:29092"
client_id = "flare-im"
timeout_ms = 30000

[kafka.message]
bootstrap_servers = "127.0.0.1:29092"
client_id = "flare-message-orchestrator"
timeout_ms = 30000

[postgres.media]
url = "postgres://flare:flare123@localhost:25432/flare"
max_connections = 20

[mongodb.primary]
url = "mongodb://localhost:27017"
database = "flare"

# 对象存储配置 - 简化为单一配置，通过环境变量或部署时配置选择具体后端
# 默认使用 rusFS 对象存储配置
[object_storage.default]
profile_type = "s3"
endpoint = "http://localhost:29000"
access_key = "rustfsadmin"
secret_key = "rustfsadmin"
bucket = "flare-media"
region = "us-east-1"
use_ssl = false
cdn_base_url = "http://localhost:29000/flare-media"
# 预签名URL过期时间（秒），默认1小时
presign_url_ttl_seconds = 3600
use_presign = true
bucket_root_prefix = "media"
force_path_style = true

# MinIO 对象存储配置（备用）
[object_storage.minio]
profile_type = "minio"
endpoint = "http://localhost:29000"
access_key = "minioadmin"
secret_key = "minioadmin"
bucket = "flare-media"
region = "us-east-1"
use_ssl = false
cdn_base_url = "http://localhost:29000/flare-media"
# 预签名URL过期时间（秒），默认1小时
presign_url_ttl_seconds = 3600
use_presign = true
bucket_root_prefix = "media"
force_path_style = true

# 可选：如果需要多个对象存储配置，可以定义多个profile
# [object_storage.production]
# profile_type = "s3"
# access_key = "your-access-key"
# secret_key = "your-secret-key"
# bucket = "your-bucket-name"
# region = "us-west-2"
# presign_url_ttl_seconds = 3600