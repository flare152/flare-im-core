# Flare Session Service ConfigMap 示例
#
# 使用方法:
#   kubectl apply -f deploy/k8s/configmaps/session-config.yaml

apiVersion: v1
kind: ConfigMap
metadata:
  name: flare-session-config
  namespace: flare-im
  labels:
    app: flare-session
data:
  # 服务特定配置
  session.toml: |
    [services.session]
    service_name = "flare-session"
    
    # 引用 base-config ConfigMap 中的 Redis 配置
    redis = "session_store"
    
    # 服务特定配置
    session_state_prefix = "storage:session:state"
    session_unread_prefix = "storage:session:unread"
    user_cursor_prefix = "storage:user:cursor"
    presence_prefix = "presence:user"
    
    # 消息存储服务端点（从服务发现获取）
    storage_reader_endpoint = "http://flare-storage-reader.flare-im.svc.cluster.local:60083"
    
    recent_message_limit = 20
    
    [services.session.default_policy]
    conflict_resolution = "coexist"
    max_devices = 5
    allow_anonymous = false
    allow_history_sync = true
    
    [services.session.server]
    address = "0.0.0.0"
    port = 50090

